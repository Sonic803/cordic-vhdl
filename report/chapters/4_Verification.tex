\chapter{Verification and testing}

\section{Testbench}
The testbench CORDIC\_tb verifies the basic funcionality of the circuit by performing a power on reset and iteratevely gives one input and waits for the corresponing output. For debugging reasons the testbench also print the output values on the console.

\begin{code}
    \inputminted{vhdl}{../vhdl/tb/CORDIC_tb.vhd}
    \captionof{listing}{\texttt{CORDIC\_tb.vhd}}
    \label{code:testbench}
\end{code}

% TODO CAMBIARE IMMAGINI
\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.9\textwidth]{./images/Verification/wavesmall.png}
    \caption{Simulation of a single iteration of the testbench}
    \label{fig:wavesmall}
\end{figure}

\begin{figure}[!ht]
    \centering
    \includegraphics[width=0.9\textwidth]{./images/Verification/wavebig.png}
    \caption{Full simulation of the testbench}
    \label{fig:wavebig}
\end{figure}


\section{Graph testbench}
This testbench servers the purpose of ensuring the functionality of the circuit over the range of possible inputs. The test was performed on \( 512 \times 512 \)  input points uniformly distributed within the range \( (-128, 128) \) for both \( x \) and \( y \).

\begin{code}
    \inputminted{vhdl}{../vhdl/tb/GRAPH_tb.vhd}
    \captionof{listing}{\texttt{GRAPH\_tb.vhd}}
    \label{code:testbench_graph}
\end{code}

\section{Verification}

\section{Error verification}
The implementation of the CORDIC algorithm in vectoring mode for Cartesian-to-polar conversion demonstrates 
exceptional accuracy in both the module (\( \rho \)) and phase (\( \theta \)) outputs. Using a fixed-point 
representation of \( Q8.8 \) for \( \rho \) and \( Q3.13 \) for \( \theta \), the errors were summarized as follows:

\[
\text{Module Error:} \quad \text{Max} = 0.004030 \, \text{units}, \quad \text{Mean} = 0.001889 \, \text{units}
\]
\[
\text{Phase Error:} \quad \text{Max} = 0.000154 \, \text{rad}, \quad \text{Mean} = 0.000062 \, \text{rad}
\]

The test was performed on 512 Ã— 512 input points uniformly distributed within the range \( (-128, 128) \) for both \( x \) and \( y \).
This range ensures a comprehensive evaluation of the algorithm over a high range of valid inputs while maintaining 
consistency with the precision of the fixed-point formats used. The fixed-point representation employed provides a precision 
of \( 2^{-8} \) for \( Q8.8 \) (module) and \( 2^{-13} \) for \( Q3.13 \) (phase). 
\[
    \text{Module Error:} \log_2(\text{Max error}) \approx -7.955
\]
\[
    \text{Phase Error:} \log_2(\text{Max error}) \approx -12.664
\]
The observed errors are well within these precision limits, with all measured deltas smaller than the respective numerical precision of the formats. Any discrepancies between the input and output values are solely due to the conversion of these fixed-point representations into real numbers for plotting and analysis. 
\\\\
The 3D plots of module and phase errors visually confirm the bounded and negligible nature of the errors across 
all tested input combinations. Assuming no error on the input, this analysis validates that the algorithm introduces 
no error in the output, demonstrating the precision and robustness of CORDIC algorithm thanks to the 24 bits internal logic.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{./images/Verification/module_error.png}
    \caption{3D plot of module error (\( \rho \)).}
    \label{fig:module_error}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{./images/Verification/phase_error.png}
    \caption{3D plot of phase error (\( \theta \)).}
    \label{fig:phase_error}
\end{figure}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{./images/Verification/heatmap.png}
    \caption{Heatmap for phase and module errors.}
    \label{fig:heatmap_error}
\end{figure}








